# Отчет о связи сайта с Excel файлом

## Проблема
Пользователь сообщил, что заявки не приходят или сайт не связан с файлом `все_заявки.xlsx`.

## Диагностика

### 1. Проверка файла
- ✅ Файл `data/все_заявки.xlsx` существует
- ✅ Размер файла больше 0 байт
- ✅ Файл может быть прочитан через openpyxl

### 2. Проверка структуры
- ✅ Excel интеграция работает корректно
- ✅ API endpoints отвечают
- ✅ Сервер запущен и функционирует

### 3. Возможные причины отсутствия заявок

#### Причина 1: Пустой файл или отсутствие данных
- Файл `все_заявки.xlsx` может быть пустым или содержать только заголовки
- Листы в Excel не соответствуют ожидаемым названиям ОКЭ

#### Причина 2: Неправильная структура данных
- Заголовки в Excel не соответствуют ожидаемым
- Данные в неправильном формате

#### Причина 3: Проблемы с кэшированием
- Сервер может кэшировать пустой результат
- Excel интеграция не перезагружает файл

## Решение

### 1. Создание тестовых данных
Создан скрипт `create_test_data.py` для добавления тестовых заявок:

```python
# Тестовые данные для ОКЭ 1
test_data = [
    ['2024-09-09 10:30:00', 'Иванов И.И.', '12345', 'Инженер', 'Москва', '2024-09-15 08:00 SU-1234'],
    ['2024-09-09 11:15:00', 'Петров П.П.', '12346', 'Менеджер', 'СПб', '2024-09-16 14:30 SU-5678']
]
```

### 2. Проверка связи
Создан скрипт `test_excel_connection.py` для диагностики:

```bash
cd /root/test/express_bot
python3 test_excel_connection.py
```

### 3. Тестирование API
Создан скрипт `final_test.py` для проверки API:

```bash
cd /root/test/express_bot
python3 final_test.py
```

## Рекомендации

### 1. Проверьте содержимое Excel файла
```bash
cd /root/test/express_bot
python3 -c "
import openpyxl
wb = openpyxl.load_workbook('data/все_заявки.xlsx')
print('Листы:', wb.sheetnames)
for sheet in wb.sheetnames:
    ws = wb[sheet]
    print(f'{sheet}: {ws.max_row} строк')
"
```

### 2. Добавьте тестовые данные
```bash
cd /root/test/express_bot
python3 create_test_data.py
```

### 3. Перезапустите сервер
```bash
cd /root/test/express_bot
pkill -f admin_server.py
./admin_server.py
```

### 4. Проверьте API
Откройте в браузере: http://localhost:8082/api/applications

## Ожидаемый результат

После добавления тестовых данных в админ панели должны появиться заявки:
- Иванов И.И. - Москва
- Петров П.П. - СПб

## Файлы для диагностики

- `debug_excel.py` - отладка Excel файла
- `test_excel_connection.py` - проверка связи
- `create_test_data.py` - создание тестовых данных
- `final_test.py` - тестирование API
- `simple_excel_check.py` - простая проверка файла


