# üöÄ Express SmartApp - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Express SmartApp** —Å–æ–≥–ª–∞—Å–Ω–æ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º—É —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ Express](https://docs.express.ms/smartapps/developer-guide/). SmartApp —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: **Frontend (SPA)** –∏ **Backend (–ß–∞—Ç-–±–æ—Ç)**.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Express

### **Frontend (SPA-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)**
- **–§–∞–π–ª:** `express_smartapp_frontend.html`
- **–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:** –≤–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º **WebView/iFrame** –∫–ª–∏–µ–Ω—Ç–∞ Express
- **–¢–∏–ø:** Single Page Application (SPA)
- **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:** —Å Backend —á–µ—Ä–µ–∑ **Bot API**

### **Backend (–ß–∞—Ç-–±–æ—Ç)**
- **–§–∞–π–ª:** `express_smartapp_bot.py`
- **–†–µ–∞–ª–∏–∑—É–µ—Ç:** **Bot API** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç frontend
- **–†–∞–±–æ—Ç–∞–µ—Ç —Å:** **BotX API** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Express
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ Express)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É frontend –∏ BotX
- **–¢–æ–∫–µ–Ω—ã:** –ü–µ—Ä–µ–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ BotX API

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

### **–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** Flight Booking SmartApp
- **–í–µ—Ä—Å–∏—è:** 1.0.0
- **–ü–æ—Ä—Ç:** 5006
- **Frontend:** SPA –≤ WebView Express
- **Backend:** –ß–∞—Ç-–±–æ—Ç —Å Bot API

### **API —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- **Frontend:** `http://localhost:5006/` - SPA –¥–ª—è WebView
- **Bot API:** `http://localhost:5006/api/smartapp/` - –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **Health:** `http://localhost:5006/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

## üöÄ –ó–∞–ø—É—Å–∫

### **–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫:**
```bash
cd /root/test/express_bot
./start_express_smartapp_correct.sh
```

### **–û—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
./stop_express_smartapp_correct.sh
```

## üì± Frontend (SPA)

### **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω** –¥–ª—è WebView Express
- **–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **JavaScript –∫–ª–∞—Å—Å** `ExpressSmartApp` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ** —Å Backend —á–µ—Ä–µ–∑ Bot API

### **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- üìù **–ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏** - —Ñ–æ—Ä–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- üìã **–ú–æ–∏ –∑–∞—è–≤–∫–∏** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üìÖ **–ü–µ—Ä–∏–æ–¥—ã –ø–æ–¥–∞—á–∏** - –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞—è–≤–∫–∞–º

## ü§ñ Backend (–ß–∞—Ç-–±–æ—Ç)

### **Bot API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):**

#### **1. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ:**
```http
GET /api/smartapp/info
```

#### **2. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏:**
```http
POST /api/smartapp/submit
Content-Type: application/json

{
  "form_data": {
    "location": "–ú–æ—Å–∫–≤–∞",
    "oke": "–û–ö–≠ 1",
    "date": "2025-09-20",
    "position": "–ë–ü",
    "fio": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
    "tab_num": "123456",
    "direction": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
    "wishes": "–û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è"
  },
  "user_context": {
    "user_id": "express_user_123",
    "user_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "platform": "express_smartapp",
    "express_token": "token_from_express"
  }
}
```

#### **3. –ó–∞—è–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```http
GET /api/smartapp/applications/{user_id}
```

#### **4. –ü–µ—Ä–∏–æ–¥—ã –ø–æ–¥–∞—á–∏:**
```http
GET /api/smartapp/periods
```

#### **5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
```http
GET /api/smartapp/statistics
```

### **BotX API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- **URL:** `http://localhost:8080/api/botx/`
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** Bearer —Ç–æ–∫–µ–Ω –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- **Fallback:** Flask API –µ—Å–ª–∏ BotX –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Express –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–º

### **1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Express —Å–µ—Ä–≤–µ—Ä–µ:**

–°–æ–≥–ª–∞—Å–Ω–æ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Express SmartApp](https://docs.express.ms/smartapps/developer-guide/):

1. **–î–æ–±–∞–≤–∏—Ç—å SmartApp –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Express:**
   - **Frontend URL:** `http://your-server:5006/`
   - **–ù–∞–∑–≤–∞–Ω–∏–µ:** "Flight Booking SmartApp"
   - **–¢–∏–ø:** SPA –≤ WebView

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —á–∞—Ç-–±–æ—Ç–∞:**
   - **Bot API URL:** `http://your-server:5006/api/smartapp/`
   - **BotX API URL:** `http://your-server:8080/api/botx/`
   - **–¢–æ–∫–µ–Ω:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Express

### **2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Express —Å–µ—Ä–≤–µ—Ä–∞:**

```yaml
smartapps:
  - name: "Flight Booking SmartApp"
    frontend_url: "http://localhost:5006/"
    bot_api_url: "http://localhost:5006/api/smartapp/"
    botx_api_url: "http://localhost:8080/api/botx/"
    type: "spa_webview"
    bot_token: "your_bot_token_here"
```

### **3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–Ω–æ Express:**

- **Frontend** - SPA –¥–ª—è WebView Express
- **Bot API** - –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç frontend
- **BotX API** - —Å —Ç–æ–∫–µ–Ω–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Express
- **–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ** –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:5006/health

# Frontend SPA
curl http://localhost:5006/

# Bot API info
curl http://localhost:5006/api/smartapp/info

# –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏
curl -X POST http://localhost:5006/api/smartapp/submit \
  -H "Content-Type: application/json" \
  -d '{
    "form_data": {
      "location": "–ú–æ—Å–∫–≤–∞",
      "oke": "–û–ö–≠ 1",
      "date": "2025-09-20",
      "position": "–ë–ü",
      "fio": "–¢–µ—Å—Ç –¢–µ—Å—Ç–æ–≤–∏—á",
      "tab_num": "123456",
      "direction": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
      "wishes": "–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞"
    },
    "user_context": {
      "user_id": "express_test_user",
      "user_name": "–¢–µ—Å—Ç –¢–µ—Å—Ç–æ–≤–∏—á",
      "platform": "express_smartapp",
      "express_token": "mock_token"
    }
  }'
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **–õ–æ–≥–∏:**
```bash
tail -f logs/express_smartapp_bot.log
```

### **–°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**
```bash
ps aux | grep express_smartapp_bot
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤:**
```bash
netstat -tlnp | grep 5006
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### **–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Express:**
1. **–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ** –º–µ–∂–¥—É frontend –∏ BotX
2. **–¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ BotX API
3. **Bot API –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - —Ç–æ–ª—å–∫–æ –¥–ª—è frontend
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

**Express SmartApp –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Express!**

### **‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ:**
- ‚úÖ **Frontend SPA** –¥–ª—è WebView Express
- ‚úÖ **Backend —á–∞—Ç-–±–æ—Ç** —Å Bot API
- ‚úÖ **BotX API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚úÖ **–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### **üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ URL:**
- **Frontend SPA:** http://localhost:5006/
- **Bot API:** http://localhost:5006/api/smartapp/
- **Health Check:** http://localhost:5006/health

### **üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Express:**
1. **Frontend** –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ WebView Express
2. **Bot API** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç frontend
3. **BotX API** –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å Express —Å–µ—Ä–≤–µ—Ä–æ–º
4. **–¢–æ–∫–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

**SmartApp –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ Express –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏!** üöÄ‚úàÔ∏è







