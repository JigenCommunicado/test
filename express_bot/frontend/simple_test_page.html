<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Express SmartApp</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; margin-bottom: 30px; }
        .test-section { margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .result { margin-top: 15px; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .links { text-align: center; margin: 30px 0; }
        .links a { display: inline-block; margin: 10px; padding: 15px 30px; background: #4facfe; color: white; text-decoration: none; border-radius: 10px; }
        .links a:hover { background: #3d8bfe; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Express SmartApp</h1>
        
        <div class="links">
            <a href="http://localhost:8080/index.html" target="_blank">üè† –ì–ª–∞–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (–ø–æ—Ä—Ç 8080)</a>
            <a href="http://localhost:8080/flight_booking_ui.html" target="_blank">üì± –§–æ—Ä–º–∞ –∑–∞—è–≤–∫–∏ (–ø–æ—Ä—Ç 8080)</a>
            <a href="http://localhost:8080/admin_panel.html" target="_blank">üîß –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (–ø–æ—Ä—Ç 8080)</a>
            <a href="http://localhost:5002/health" target="_blank">‚ö° API Health Check (–ø–æ—Ä—Ç 5002)</a>
        </div>
        
        <div class="test-section">
            <h3>üìä –¢–µ—Å—Ç Excel –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h3>
            <button class="btn btn-primary" onclick="testExcelIntegration()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Excel –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é</button>
            <button class="btn btn-info" onclick="getStatistics()">–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
            <div id="excel-result"></div>
        </div>

        <div class="test-section">
            <h3>üìù –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É</h3>
            <button class="btn btn-success" onclick="createTestApplication()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É</button>
            <div id="application-result"></div>
        </div>

        <div class="test-section">
            <h3>üîß API —Ç–µ—Å—Ç—ã</h3>
            <button class="btn btn-primary" onclick="testAPI()">–¢–µ—Å—Ç –≤—Å–µ—Ö API</button>
            <button class="btn btn-info" onclick="testNewFeatures()">–¢–µ—Å—Ç –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π</button>
            <div id="api-result"></div>
        </div>

        <div class="test-section">
            <h3>üóìÔ∏è –¢–µ—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞–º–∏</h3>
            <button class="btn btn-primary" onclick="testPeriods()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–∏–æ–¥—ã –∑–∞—è–≤–æ–∫</button>
            <div id="periods-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</h3>
            <p><strong>–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong></p>
            <ol>
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã: <code>./manage.sh</code></li>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ <a href="http://localhost:8080/index.html" target="_blank">–ì–ª–∞–≤–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é</a> –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º</li>
                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API</li>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ <a href="http://localhost:8080/admin_panel.html" target="_blank">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a> –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π</li>
            </ol>
        </div>
    </div>

    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        async function testExcelIntegration() {
            try {
                const response = await fetch('http://localhost:5002/api/statistics');
                const data = await response.json();
                
                if (response.ok) {
                    showResult('excel-result', `‚úÖ Excel –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!<br><pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                } else {
                    showResult('excel-result', `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult('excel-result', `‚ùå –û—à–∏–±–∫–∞: ${error.message}<br><br>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Flask —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5002`, 'error');
            }
        }

        async function getStatistics() {
            try {
                const response = await fetch('http://localhost:5002/api/statistics');
                const data = await response.json();
                
                if (response.ok) {
                    const stats = data.statistics;
                    let statsText = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—è–≤–æ–∫:\n';
                    for (const [oke, count] of Object.entries(stats)) {
                        statsText += `${oke}: ${count} –∑–∞—è–≤–æ–∫\n`;
                    }
                    showResult('excel-result', `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞:<br><pre>${statsText}</pre>`, 'info');
                } else {
                    showResult('excel-result', `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult('excel-result', `‚ùå –û—à–∏–±–∫–∞: ${error.message}<br><br>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Flask —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5002`, 'error');
            }
        }

        async function createTestApplication() {
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π API
                const applicationData = {
                    user_id: 'test_' + Date.now(),
                    location: '–ú–æ—Å–∫–≤–∞',
                    oke: '–û–ö–≠ 1',
                    date: '2025-09-20',
                    position: '–ë–ü',
                    fio: '–¢–µ—Å—Ç –¢–µ—Å—Ç –¢–µ—Å—Ç–æ–≤–∏—á',
                    tab_num: '123456',
                    direction: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',
                    wishes: '–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ —á–µ—Ä–µ–∑ API'
                };

                const response = await fetch('http://localhost:5002/api/application', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(applicationData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('application-result', `‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!<br><pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                } else {
                    showResult('application-result', `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
                
            } catch (error) {
                showResult('application-result', `‚ùå –û—à–∏–±–∫–∞: ${error.message}<br><br>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Flask —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5002`, 'error');
            }
        }

        async function testAPI() {
            const endpoints = [
                { name: 'Flask Health', url: 'http://localhost:5002/health', method: 'GET' },
                { name: 'Flask Statistics', url: 'http://localhost:5002/api/statistics', method: 'GET' },
                { name: 'Flask Main Page', url: 'http://localhost:5002/', method: 'GET' },
                { name: 'Static Server', url: 'http://localhost:8080/', method: 'GET' },
                { name: 'Flight Booking UI', url: 'http://localhost:8080/flight_booking_ui.html', method: 'GET' },
                { name: 'Admin Panel', url: 'http://localhost:8080/admin_panel.html', method: 'GET' }
            ];

            let result = '–¢–µ—Å—Ç API endpoints:\n';
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint.url, { method: endpoint.method });
                    if (response.ok) {
                        result += `‚úÖ ${endpoint.name}: OK (${response.status})\n`;
                    } else {
                        result += `‚ùå ${endpoint.name}: Failed (${response.status})\n`;
                    }
                } catch (error) {
                    result += `‚ùå ${endpoint.name}: Error - ${error.message}\n`;
                }
            }
            
            showResult('api-result', `<pre>${result}</pre>`, 'info');
        }

        async function testNewFeatures() {
            const features = [
                { name: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞–º–∏', url: 'http://localhost:8080/application_periods.html' },
                { name: '–ü–æ–∏—Å–∫ –∑–∞—è–≤–æ–∫', url: 'http://localhost:8080/search_interface.html' },
                { name: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', url: 'http://localhost:8080/notifications.html' },
                { name: '–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è', url: 'http://localhost:8080/mobile_booking_ui.html' }
            ];

            let result = '–¢–µ—Å—Ç –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:\n';
            
            for (const feature of features) {
                try {
                    const response = await fetch(feature.url, { method: 'GET' });
                    if (response.ok) {
                        result += `‚úÖ ${feature.name}: –î–æ—Å—Ç—É–ø–Ω–∞\n`;
                    } else {
                        result += `‚ùå ${feature.name}: –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (${response.status})\n`;
                    }
                } catch (error) {
                    result += `‚ùå ${feature.name}: –û—à–∏–±–∫–∞ - ${error.message}\n`;
                }
            }
            
            showResult('api-result', `<pre>${result}</pre>`, 'info');
        }

        async function testPeriods() {
            try {
                const response = await fetch('http://localhost:5002/api/application-periods');
                const data = await response.json();
                
                if (response.ok) {
                    showResult('periods-result', `‚úÖ API –ø–µ—Ä–∏–æ–¥–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç!<br><pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                } else {
                    showResult('periods-result', `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult('periods-result', `‚ùå –û—à–∏–±–∫–∞: ${error.message}<br><br>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Flask —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5002`, 'error');
            }
        }
    </script>
</body>
</html>

