#!/bin/bash

# –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Express SmartApp
# –ê–≤—Ç–æ—Ä: AI Assistant
# –î–∞—Ç–∞: $(date)

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
print_header() {
    echo -e "${CYAN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "${CYAN}‚ïë                    Express SmartApp Manager                 ‚ïë${NC}"
    echo -e "${CYAN}‚ïë                –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è              ‚ïë${NC}"
    echo -e "${CYAN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –º–µ–Ω—é
print_menu() {
    echo -e "${YELLOW}–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:${NC}"
    echo ""
    echo -e "${GREEN}1.${NC} üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã"
    echo -e "${GREEN}2.${NC} üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã"
    echo -e "${GREEN}3.${NC} üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã"
    echo -e "${GREEN}4.${NC} üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–æ–≤"
    echo -e "${GREEN}5.${NC} üìù –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ Flask —Å–µ—Ä–≤–µ—Ä–∞"
    echo -e "${GREEN}6.${NC} üìù –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞"
    echo -e "${GREEN}7.${NC} üåê –û—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
    echo -e "${GREEN}8.${NC} üîß –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
    echo -e "${GREEN}9.${NC} üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    echo -e "${GREEN}0.${NC} üö™ –í—ã—Ö–æ–¥"
    echo ""
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
show_stats() {
    echo -e "${BLUE}üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Express SmartApp:${NC}"
    echo ""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º Flask —Å–µ—Ä–≤–µ—Ä
    if curl -s http://localhost:5002/health > /dev/null 2>&1; then
        echo -e "${GREEN}‚úÖ Flask API —Å–µ—Ä–≤–µ—Ä: –ó–∞–ø—É—â–µ–Ω${NC}"
        
        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        echo -e "${YELLOW}üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—è–≤–æ–∫:${NC}"
        curl -s http://localhost:5002/api/statistics | python3 -m json.tool 2>/dev/null || echo "   ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"
    else
        echo -e "${RED}‚ùå Flask API —Å–µ—Ä–≤–µ—Ä: –ù–µ –∑–∞–ø—É—â–µ–Ω${NC}"
    fi
    
    echo ""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä
    if curl -s http://localhost:8080/ > /dev/null 2>&1; then
        echo -e "${GREEN}‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä: –ó–∞–ø—É—â–µ–Ω${NC}"
    else
        echo -e "${RED}‚ùå –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä: –ù–µ –∑–∞–ø—É—â–µ–Ω${NC}"
    fi
    
    echo ""
    echo -e "${YELLOW}üìÅ –§–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö:${NC}"
    if [ -f "data/–≤—Å–µ_–∑–∞—è–≤–∫–∏.xlsx" ]; then
        echo -e "   ‚úÖ Excel —Ñ–∞–π–ª —Å –∑–∞—è–≤–∫–∞–º–∏: $(ls -lh data/–≤—Å–µ_–∑–∞—è–≤–∫–∏.xlsx | awk '{print $5}')"
    else
        echo -e "   ‚ùå Excel —Ñ–∞–π–ª —Å –∑–∞—è–≤–∫–∞–º–∏: –ù–µ –Ω–∞–π–¥–µ–Ω"
    fi
    
    if [ -f "smartapp.log" ]; then
        echo -e "   ‚úÖ –õ–æ–≥ Flask —Å–µ—Ä–≤–µ—Ä–∞: $(ls -lh smartapp.log | awk '{print $5}')"
    fi
    
    if [ -f "static.log" ]; then
        echo -e "   ‚úÖ –õ–æ–≥ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞: $(ls -lh static.log | awk '{print $5}')"
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –ª–æ–≥–æ–≤
show_logs() {
    local log_type=$1
    echo -e "${BLUE}üìù –õ–æ–≥–∏ $log_type:${NC}"
    echo ""
    
    if [ "$log_type" = "Flask" ]; then
        if [ -f "smartapp.log" ]; then
            tail -20 smartapp.log
        else
            echo -e "${RED}‚ùå –õ–æ–≥ —Ñ–∞–π–ª Flask —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω${NC}"
        fi
    else
        if [ -f "static.log" ]; then
            tail -20 static.log
        else
            echo -e "${RED}‚ùå –õ–æ–≥ —Ñ–∞–π–ª —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω${NC}"
        fi
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open_browser() {
    local url=$1
    echo -e "${BLUE}üåê –û—Ç–∫—Ä—ã—Ç–∏–µ $url –≤ –±—Ä–∞—É–∑–µ—Ä–µ...${NC}"
    
    # –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
    if command -v xdg-open > /dev/null; then
        xdg-open "$url" 2>/dev/null &
    elif command -v firefox > /dev/null; then
        firefox "$url" 2>/dev/null &
    elif command -v google-chrome > /dev/null; then
        google-chrome "$url" 2>/dev/null &
    else
        echo -e "${YELLOW}‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏${NC}"
        echo -e "${YELLOW}   –û—Ç–∫—Ä–æ–π—Ç–µ –≤—Ä—É—á–Ω—É—é: $url${NC}"
    fi
}

# –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
main() {
    print_header
    
    while true; do
        print_menu
        read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–π—Å—Ç–≤–∏—è (0-9): " choice
        
        case $choice in
            1)
                echo -e "${GREEN}üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤...${NC}"
                ./start_servers.sh
                ;;
            2)
                echo -e "${RED}üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤...${NC}"
                ./stop_servers.sh
                ;;
            3)
                echo -e "${YELLOW}üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤...${NC}"
                ./restart_servers.sh
                ;;
            4)
                ./status_servers.sh
                ;;
            5)
                show_logs "Flask"
                ;;
            6)
                show_logs "—Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞"
                ;;
            7)
                open_browser "http://localhost:8080/index.html"
                ;;
            8)
                open_browser "http://localhost:8080/admin_panel.html"
                ;;
            9)
                show_stats
                ;;
            0)
                echo -e "${PURPLE}üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!${NC}"
                exit 0
                ;;
            *)
                echo -e "${RED}‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.${NC}"
                ;;
        esac
        
        echo ""
        read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..."
        clear
        print_header
    done
}

# –ó–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
main

