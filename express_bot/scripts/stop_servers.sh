#!/bin/bash

# ะกะบัะธะฟั ะดะปั ะพััะฐะฝะพะฒะบะธ ะฒัะตั ัะตัะฒะตัะพะฒ Express SmartApp
# ะะฒัะพั: AI Assistant
# ะะฐัะฐ: $(date)

echo "๐ ะััะฐะฝะพะฒะบะฐ Express SmartApp ัะตัะฒะตัะพะฒ..."

# ะะตัะตัะพะดะธะผ ะฒ ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ
cd /root/test/express_bot

# ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ Flask ัะตัะฒะตั
echo "๐ ะััะฐะฝะพะฒะบะฐ Flask API ัะตัะฒะตัะฐ..."
if [ -f flask.pid ]; then
    FLASK_PID=$(cat flask.pid)
    if kill -0 $FLASK_PID 2>/dev/null; then
        kill $FLASK_PID
        echo "โ Flask ัะตัะฒะตั ะพััะฐะฝะพะฒะปะตะฝ (PID: $FLASK_PID)"
    else
        echo "โ๏ธ  Flask ัะตัะฒะตั ัะถะต ะพััะฐะฝะพะฒะปะตะฝ"
    fi
    rm -f flask.pid
else
    echo "โ๏ธ  PID ัะฐะนะป Flask ัะตัะฒะตัะฐ ะฝะต ะฝะฐะนะดะตะฝ"
fi

# ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ััะฐัะธัะตัะบะธะน ัะตัะฒะตั
echo "๐ ะััะฐะฝะพะฒะบะฐ ััะฐัะธัะตัะบะพะณะพ ัะตัะฒะตัะฐ..."
if [ -f static.pid ]; then
    STATIC_PID=$(cat static.pid)
    if kill -0 $STATIC_PID 2>/dev/null; then
        kill $STATIC_PID
        echo "โ ะกัะฐัะธัะตัะบะธะน ัะตัะฒะตั ะพััะฐะฝะพะฒะปะตะฝ (PID: $STATIC_PID)"
    else
        echo "โ๏ธ  ะกัะฐัะธัะตัะบะธะน ัะตัะฒะตั ัะถะต ะพััะฐะฝะพะฒะปะตะฝ"
    fi
    rm -f static.pid
else
    echo "โ๏ธ  PID ัะฐะนะป ััะฐัะธัะตัะบะพะณะพ ัะตัะฒะตัะฐ ะฝะต ะฝะฐะนะดะตะฝ"
fi

# ะัะธะฝัะดะธัะตะปัะฝะพ ะพััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั
echo "๐ ะะพะธัะบ ะธ ะพััะฐะฝะพะฒะบะฐ ะพััะฐะฒัะธััั ะฟัะพัะตััะพะฒ..."
pkill -f smartapp_flight_booking.py
pkill -f "http.server"

# ะะดะตะผ ะทะฐะฒะตััะตะฝะธั ะฟัะพัะตััะพะฒ
sleep 2

# ะัะพะฒะตััะตะผ, ััะพ ะฟะพััั ัะฒะพะฑะพะดะฝั
echo "๐ ะัะพะฒะตัะบะฐ ะพัะฒะพะฑะพะถะดะตะฝะธั ะฟะพััะพะฒ..."

if ! lsof -i :5002 > /dev/null 2>&1; then
    echo "โ ะะพัั 5002 ะพัะฒะพะฑะพะถะดะตะฝ"
else
    echo "โ ะะพัั 5002 ะฒัะต ะตัะต ะทะฐะฝัั"
fi

if ! lsof -i :8080 > /dev/null 2>&1; then
    echo "โ ะะพัั 8080 ะพัะฒะพะฑะพะถะดะตะฝ"
else
    echo "โ ะะพัั 8080 ะฒัะต ะตัะต ะทะฐะฝัั"
fi

echo ""
echo "๐ ะัะต ัะตัะฒะตัั ะพััะฐะฝะพะฒะปะตะฝั!"
echo ""
echo "๐ ะะปั ะทะฐะฟััะบะฐ ัะตัะฒะตัะพะฒ ะฒัะฟะพะปะฝะธัะต: ./start_servers.sh"

