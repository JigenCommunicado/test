<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Express SmartApp - –ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–π—Å</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: var(--tg-theme-bg-color, #ffffff);
            --tg-theme-text-color: var(--tg-theme-text-color, #000000);
            --tg-theme-button-color: var(--tg-theme-button-color, #0088cc);
            --tg-theme-button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --tg-theme-secondary-bg-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            --tg-theme-hint-color: var(--tg-theme-hint-color, #999999);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            line-height: 1.5;
            padding: 16px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--tg-theme-bg-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .header {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            padding: 20px;
            text-align: center;
            border-radius: 12px 12px 0 0;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .platform-info {
            background: var(--tg-theme-secondary-bg-color);
            padding: 12px;
            text-align: center;
            font-size: 14px;
            color: var(--tg-theme-hint-color);
        }

        .form-container {
            padding: 24px;
        }

        .progress-container {
            margin-bottom: 24px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--tg-theme-button-color);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .step-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 14px;
            color: var(--tg-theme-hint-color);
        }

        .form-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .form-step.active {
            display: block !important;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--tg-theme-text-color);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--tg-theme-secondary-bg-color);
            border-radius: 8px;
            font-size: 16px;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--tg-theme-button-color);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
        }

        .btn-secondary {
            background: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .review-section {
            background: var(--tg-theme-secondary-bg-color);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .review-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .review-label {
            font-weight: 500;
            color: var(--tg-theme-hint-color);
        }

        .review-value {
            font-weight: 600;
            color: var(--tg-theme-text-color);
        }

        .success-message {
            text-align: center;
            padding: 40px 20px;
        }

        .success-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .error-message {
            background: #ffe6e6;
            color: #d63031;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }

        .info-message {
            background: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }

            .container {
                border-radius: 8px;
            }

            .header {
                padding: 16px;
                border-radius: 8px 8px 0 0;
            }

            .header h1 {
                font-size: 20px;
            }

            .form-container {
                padding: 16px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                margin-bottom: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚úàÔ∏è –ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–π—Å</h1>
            <div id="telegramInfo">Express SmartApp</div>
        </div>

        <div class="platform-info" id="platformInfo">
            üì± –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>

        <div class="form-container">
            <div class="info-message">
                <strong>üìù –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è:</strong> –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="step-info">
                    <span id="stepText">–®–∞–≥ 1 –∏–∑ 9</span>
                    <span id="stepName">–õ–æ–∫–∞—Ü–∏—è</span>
                </div>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <!-- –®–∞–≥ 1: –õ–æ–∫–∞—Ü–∏—è -->
            <div class="form-step active" id="step1">
                <div class="form-group">
                    <label for="location">üè¢ –í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é:</label>
                    <select id="location" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é</option>
                        <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
                        <option value="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
                        <option value="–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫">–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫</option>
                        <option value="–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥</option>
                        <option value="–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫">–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫</option>
                        <option value="–°–æ—á–∏">–°–æ—á–∏</option>
                    </select>
                </div>
            </div>

            <!-- –®–∞–≥ 2: –û–ö–≠ -->
            <div class="form-step" id="step2">
                <div class="form-group">
                    <label for="oke">üèõÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –û–ö–≠:</label>
                    <select id="oke" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –û–ö–≠</option>
                        <option value="–û–ö–≠ 1">–û–ö–≠ 1</option>
                        <option value="–û–ö–≠ 2">–û–ö–≠ 2</option>
                        <option value="–û–ö–≠ 3">–û–ö–≠ 3</option>
                        <option value="–û–ö–≠ 4">–û–ö–≠ 4</option>
                        <option value="–û–ö–≠ 5">–û–ö–≠ 5</option>
                        <option value="–û–ö–≠ –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫">–û–ö–≠ –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫</option>
                        <option value="–û–ö–≠ –°–æ—á–∏">–û–ö–≠ –°–æ—á–∏</option>
                        <option value="–û–õ–°–∏–¢">–û–õ–°–∏–¢</option>
                    </select>
                </div>
            </div>

            <!-- –®–∞–≥ 3: –î–∞—Ç–∞ -->
            <div class="form-step" id="step3">
                <div class="form-group">
                    <label for="date">üìÖ –ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –¥–∞—Ç–∞ –≤—ã–ª–µ—Ç–∞:</label>
                    <input type="date" id="date" required>
                </div>
            </div>

            <!-- –®–∞–≥ 4: –î–æ–ª–∂–Ω–æ—Å—Ç—å -->
            <div class="form-step" id="step4">
                <div class="form-group">
                    <label for="position">üëî –î–æ–ª–∂–Ω–æ—Å—Ç—å:</label>
                    <select id="position" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–ª–∂–Ω–æ—Å—Ç—å</option>
                        <option value="–ë–ü">–ë–ü</option>
                        <option value="–†–ü">–†–ü</option>
                        <option value="–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç">–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</option>
                        <option value="–≠–∫—Å–ø–µ—Ä—Ç">–≠–∫—Å–ø–µ—Ä—Ç</option>
                        <option value="–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å">–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</option>
                    </select>
                </div>
            </div>

            <!-- –®–∞–≥ 5: –§–ò–û -->
            <div class="form-step" id="step5">
                <div class="form-group">
                    <label for="fio">üë§ –§–ò–û:</label>
                    <input type="text" id="fio" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" required>
                </div>
            </div>

            <!-- –®–∞–≥ 6: –¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä -->
            <div class="form-step" id="step6">
                <div class="form-group">
                    <label for="tabNum">üÜî –¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä:</label>
                    <input type="text" id="tabNum" placeholder="123456" required>
                </div>
            </div>

            <!-- –®–∞–≥ 7: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
            <div class="form-step" id="step7">
                <div class="form-group">
                    <label for="direction">üéØ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</label>
                    <select id="direction" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</option>
                    </select>
                </div>
            </div>

            <!-- –®–∞–≥ 8: –ü–æ–∂–µ–ª–∞–Ω–∏—è -->
            <div class="form-step" id="step8">
                <div class="form-group">
                    <label for="wishes">üí≠ –ü–æ–∂–µ–ª–∞–Ω–∏—è –∫ —Ä–µ–π—Å—É:</label>
                    <textarea id="wishes" rows="4" placeholder="–£–∫–∞–∂–∏—Ç–µ –æ—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è..."></textarea>
                </div>
            </div>

            <!-- –®–∞–≥ 9: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ -->
            <div class="form-step" id="step9">
                <h3 style="margin-bottom: 16px;">‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏</h3>
                <div class="review-section" id="reviewData"></div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
            <div class="form-step" id="stepSuccess" style="display: none;">
                <div class="success-message">
                    <div class="success-icon">üéâ</div>
                    <h3>–ó–∞—è–≤–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ!</h3>
                    <p>–î–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ –±—ã–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ Telegram –±–æ—Ç–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.</p>
                    <p style="margin-top: 16px; color: var(--tg-theme-hint-color); font-size: 14px;">
                        Mini App –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä–æ–µ—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.
                    </p>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">
                    ‚Üê –ù–∞–∑–∞–¥
                </button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                    –î–∞–ª–µ–µ ‚Üí
                </button>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = null;
        let isWebTelegram = false;
        let isMobileTelegram = false;

        if (window.Telegram && window.Telegram.WebApp) {
            tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
            const platform = tg.platform;
            isWebTelegram = platform === 'web' || platform === 'webk' || platform === 'webz';
            isMobileTelegram = platform === 'android' || platform === 'ios' || platform === 'mobile';
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É Telegram
            if (tg.themeParams) {
                document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#ffffff');
                document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#000000');
                document.documentElement.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color || '#0088cc');
                document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color || '#ffffff');
                document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', tg.themeParams.secondary_bg_color || '#f0f0f0');
                document.documentElement.style.setProperty('--tg-theme-hint-color', tg.themeParams.hint_color || '#999999');
            }

            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
            let userInfo = 'Telegram User';
            let platformInfo = '';
            
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                userInfo = `${user.first_name || ''} ${user.last_name || ''}`.trim();
                document.getElementById('fio').value = userInfo;
            }
            
            if (isWebTelegram) {
                platformInfo = 'üíª –í–µ–±-–≤–µ—Ä—Å–∏—è Telegram (–ø—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞)';
            } else if (isMobileTelegram) {
                platformInfo = 'üì± –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è Telegram (—á–µ—Ä–µ–∑ –±–æ—Ç–∞)';
            } else {
                platformInfo = `üì± Telegram (${platform})`;
            }
            
            document.getElementById('telegramInfo').innerHTML = `üëã ${userInfo}`;
            document.getElementById('platformInfo').innerHTML = platformInfo;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
            tg.MainButton.setText('üìù –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É');
            tg.MainButton.color = tg.themeParams.button_color || '#0088cc';
            tg.MainButton.textColor = tg.themeParams.button_text_color || '#ffffff';
            tg.MainButton.hide();
            
        } else {
            document.getElementById('platformInfo').innerHTML = 'üåê –í–µ–±-–±—Ä–∞—É–∑–µ—Ä (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)';
        }

        let currentStep = 1;
        const totalSteps = 9;

        // –î–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø–æ –ª–æ–∫–∞—Ü–∏—è–º
        const directionsData = {
            "–ú–æ—Å–∫–≤–∞": ["–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ö–∞–∑–∞–Ω—å", "–°–æ—á–∏"],
            "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥": ["–ú–æ—Å–∫–≤–∞", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ú—É—Ä–º–∞–Ω—Å–∫"],
            "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫": ["–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫", "–ò—Ä–∫—É—Ç—Å–∫"],
            "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥": ["–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ß–µ–ª—è–±–∏–Ω—Å–∫"],
            "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫": ["–ú–æ—Å–∫–≤–∞", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ò—Ä–∫—É—Ç—Å–∫"],
            "–°–æ—á–∏": ["–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä"]
        };

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('stepText').textContent = `–®–∞–≥ ${currentStep} –∏–∑ ${totalSteps}`;
            
            const stepNames = [
                '–õ–æ–∫–∞—Ü–∏—è', '–û–ö–≠', '–î–∞—Ç–∞', '–î–æ–ª–∂–Ω–æ—Å—Ç—å', 
                '–§–ò–û', '–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä', '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ', '–ü–æ–∂–µ–ª–∞–Ω–∏—è', '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ'
            ];
            document.getElementById('stepName').textContent = stepNames[currentStep - 1];

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —à–∞–≥–∏
            for (let i = 1; i <= totalSteps; i++) {
                document.getElementById(`step${i}`).classList.remove('active');
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —à–∞–≥
            document.getElementById(`step${currentStep}`).classList.add('active');

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏
            document.getElementById('prevBtn').style.display = currentStep > 1 ? 'block' : 'none';
            
            if (currentStep === totalSteps) {
                document.getElementById('nextBtn').textContent = 'üìù –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É';
                if (tg && tg.MainButton) {
                    tg.MainButton.show();
                    tg.MainButton.onClick(() => submitApplication());
                }
            } else {
                document.getElementById('nextBtn').textContent = '–î–∞–ª–µ–µ ‚Üí';
                if (tg && tg.MainButton) {
                    tg.MainButton.hide();
                }
            }
        }

        function validateStep(step) {
            const fields = {
                1: ['location'],
                2: ['oke'],
                3: ['date'],
                4: ['position'],
                5: ['fio'],
                6: ['tabNum'],
                7: ['direction'],
                8: [], // –ü–æ–∂–µ–ª–∞–Ω–∏—è –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
                9: []  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            };

            for (const fieldId of fields[step]) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    showError(`–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ "${field.previousElementSibling.textContent}"`);
                    field.focus();
                    return false;
                }
            }

            return true;
        }

        function nextStep() {
            if (!validateStep(currentStep)) {
                return;
            }

            hideError();

            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ª–æ–∫–∞—Ü–∏–∏
            if (currentStep === 1) {
                updateDirections();
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            if (currentStep === 8) {
                showReviewData();
            }

            if (currentStep === totalSteps) {
                submitApplication();
                return;
            }

            if (currentStep < totalSteps) {
                currentStep++;
                updateProgress();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateProgress();
                hideError();
            }
        }

        function updateDirections() {
            const location = document.getElementById('location').value;
            const directionSelect = document.getElementById('direction');
            
            directionSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</option>';
            
            if (location && directionsData[location]) {
                directionsData[location].forEach(direction => {
                    const option = document.createElement('option');
                    option.value = direction;
                    option.textContent = direction;
                    directionSelect.appendChild(option);
                });
            }
        }

        function showReviewData() {
            const reviewData = document.getElementById('reviewData');
            const data = {
                '–õ–æ–∫–∞—Ü–∏—è': document.getElementById('location').value,
                '–û–ö–≠': document.getElementById('oke').value,
                '–î–∞—Ç–∞ –≤—ã–ª–µ—Ç–∞': document.getElementById('date').value,
                '–î–æ–ª–∂–Ω–æ—Å—Ç—å': document.getElementById('position').value,
                '–§–ò–û': document.getElementById('fio').value,
                '–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä': document.getElementById('tabNum').value,
                '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ': document.getElementById('direction').value,
                '–ü–æ–∂–µ–ª–∞–Ω–∏—è': document.getElementById('wishes').value || '–ù–µ —É–∫–∞–∑–∞–Ω—ã'
            };

            reviewData.innerHTML = '';
            for (const [label, value] of Object.entries(data)) {
                const item = document.createElement('div');
                item.className = 'review-item';
                item.innerHTML = `
                    <span class="review-label">${label}:</span>
                    <span class="review-value">${value}</span>
                `;
                reviewData.appendChild(item);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        async function submitApplication() {
            const applicationData = {
                user_id: tg && tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 'web_user_' + Date.now(),
                location: document.getElementById('location').value,
                oke: document.getElementById('oke').value,
                date: document.getElementById('date').value,
                position: document.getElementById('position').value,
                fio: document.getElementById('fio').value,
                tab_num: document.getElementById('tabNum').value,
                direction: document.getElementById('direction').value,
                wishes: document.getElementById('wishes').value,
                platform: isWebTelegram ? 'telegram_web' : isMobileTelegram ? 'telegram_mobile' : 'web_browser',
                submitted_at: new Date().toISOString()
            };

            // –í –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Telegram WebApp API
            if (isMobileTelegram && tg && tg.sendData) {
                try {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É —á–µ—Ä–µ–∑ Telegram WebApp API
                    tg.sendData(JSON.stringify({
                        action: 'submit_application',
                        data: applicationData
                    }));
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    showSuccessAndClose();
                    return;
                } catch (error) {
                    console.error('Mobile submission error:', error);
                    // Fallback –∫ –æ–±—ã—á–Ω–æ–º—É –º–µ—Ç–æ–¥—É
                }
            }

            // –î–ª—è –≤–µ–±-–≤–µ—Ä—Å–∏–∏ –∏–ª–∏ fallback - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–ø—Ä—è–º—É—é
            try {
                const response = await fetch('http://localhost:5002/api/application', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(applicationData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showSuccessAndClose();
                } else {
                    showError(result.error || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏');
                }
            } catch (error) {
                // –í –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —ç—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –±–æ—Ç—É
                if (isMobileTelegram) {
                    showSuccessAndClose();
                } else {
                    showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                    console.error('Submission error:', error);
                }
            }
        }

        function showSuccessAndClose() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            for (let i = 1; i <= totalSteps; i++) {
                document.getElementById(`step${i}`).style.display = 'none';
            }
            document.getElementById('stepSuccess').style.display = 'block';
            document.querySelector('.button-group').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            
            if (tg && tg.MainButton) {
                tg.MainButton.hide();
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º Mini App —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (tg && tg.close) {
                    tg.close();
                }
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateProgress();

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã (—Å–µ–≥–æ–¥–Ω—è)
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date').min = today;
    </script>
</body>
</html>
