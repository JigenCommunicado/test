<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ config.app_name }} - SmartApp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .step {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-title {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .step-description {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .option-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            font-weight: 500;
        }

        .option-btn:hover {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
        }

        .option-btn.selected {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }

        .calendar-header {
            text-align: center;
            font-weight: bold;
            color: #666;
            padding: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .calendar-day:hover:not(.disabled) {
            background: #4facfe;
            color: white;
        }

        .calendar-day.today {
            background: #ff6b6b;
            color: white;
        }

        .calendar-day.disabled {
            background: #f8f9fa;
            color: #ccc;
            cursor: not-allowed;
        }

        .calendar-day.selected {
            background: #4facfe;
            color: white;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4facfe;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #4facfe;
            color: white;
        }

        .btn-primary:hover {
            background: #3d8bfe;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }



        .summary {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 500;
            color: #666;
        }

        .summary-value {
            color: #333;
            font-weight: 600;
        }

        .success-message {
            text-align: center;
            padding: 40px;
        }

        .success-icon {
            font-size: 4em;
            color: #28a745;
            margin-bottom: 20px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .month-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .month-nav-btn {
            background: #4facfe;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .month-nav-btn:hover {
            background: #3d8bfe;
            transform: scale(1.1);
        }

        .month-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚úàÔ∏è {{ config.app_name }}</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ –∑–∞–∫–∞–∑–∞ —Ä–µ–π—Å–æ–≤ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
        </div>

        <div class="content">
            <!-- –®–∞–≥ 1: –í—ã–±–æ—Ä –ª–æ–∫–∞—Ü–∏–∏ -->
            <div class="step active" id="step-location">
                <h2 class="step-title">–í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é</h2>
                <p class="step-description">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É —Ä–∞–±–æ—á—É—é –ª–æ–∫–∞—Ü–∏—é –∏ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ</p>
                
                <div class="options-grid">
                    <div class="option-btn" data-location="–ú–°–ö">
                        üèôÔ∏è –ú–æ—Å–∫–≤–∞
                    </div>
                    <div class="option-btn" data-location="–°–ü–ë">
                        üåâ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
                    </div>
                    <div class="option-btn" data-location="–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫">
                        üèûÔ∏è –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫
                    </div>
                    <div class="option-btn" data-location="–°–æ—á–∏">
                        üèñÔ∏è –°–æ—á–∏
                    </div>
                </div>
            </div>

            <!-- –®–∞–≥ 2: –í—ã–±–æ—Ä –û–ö–≠ -->
            <div class="step" id="step-oke">
                <h2 class="step-title">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ</h2>
                <p class="step-description">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –û–ö–≠ (–û—Ç–¥–µ–ª –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏)</p>
                
                <div class="options-grid" id="oke-options">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="goToStep('step-location')">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </div>

            <!-- –®–∞–≥ 3: –í—ã–±–æ—Ä –¥–∞—Ç—ã -->
            <div class="step" id="step-date">
                <h2 class="step-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h2>
                <p class="step-description">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–π—Å–∞</p>
                
                <div class="month-navigation">
                    <button class="month-nav-btn" onclick="changeMonth(-1)">‚Äπ</button>
                    <div class="month-title" id="month-title">–Ø–Ω–≤–∞—Ä—å 2024</div>
                    <button class="month-nav-btn" onclick="changeMonth(1)">‚Ä∫</button>
                </div>
                
                <div class="calendar" id="calendar">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="goToStep('step-oke')">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </div>

            <!-- –®–∞–≥ 4: –í—ã–±–æ—Ä –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ -->
            <div class="step" id="step-position">
                <h2 class="step-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–ª–∂–Ω–æ—Å—Ç—å</h2>
                <p class="step-description">–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É –¥–æ–ª–∂–Ω–æ—Å—Ç—å</p>
                
                <div class="options-grid">
                    <div class="option-btn" data-position="–ë–ü">–ë–ü</div>
                    <div class="option-btn" data-position="–ë–ü BS">–ë–ü BS</div>
                    <div class="option-btn" data-position="–°–ë–≠">–°–ë–≠</div>
                    <div class="option-btn" data-position="–ò–ü–ë">–ò–ü–ë</div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="goToStep('step-date')">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </div>

            <!-- –®–∞–≥ 5: –í–≤–æ–¥ –§–ò–û -->
            <div class="step" id="step-fio">
                <h2 class="step-title">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ</h2>
                <p class="step-description">–£–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ –§–ò–û –∏ —Ç–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä</p>
                
                <div class="form-group">
                    <label for="fio">–§–ò–û</label>
                    <input type="text" id="fio" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò.–ò.">
                </div>
                
                <div class="form-group">
                    <label for="tab-num">–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä</label>
                    <input type="text" id="tab-num" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123456">
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="goToStep('step-position')">‚Üê –ù–∞–∑–∞–¥</button>
                    <button class="btn btn-primary" onclick="submitFio()">–î–∞–ª–µ–µ ‚Üí</button>
                </div>
            </div>

            <!-- –®–∞–≥ 6: –í—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="step" id="step-direction">
                <h2 class="step-title">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                <p class="step-description">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ —Ä–µ–π—Å–∞</p>
                
                <div class="options-grid" id="direction-options">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
                
                <div class="form-group">
                    <label for="custom-direction">–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</label>
                    <input type="text" id="custom-direction" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ">
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="goToStep('step-fio')">‚Üê –ù–∞–∑–∞–¥</button>
                    <button class="btn btn-primary" onclick="submitDirection()">–î–∞–ª–µ–µ ‚Üí</button>
                </div>
            </div>

            <!-- –®–∞–≥ 7: –ü–æ–∂–µ–ª–∞–Ω–∏—è -->
            <div class="step" id="step-wishes">
                <h2 class="step-title">–í–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è</h2>
                <p class="step-description">–£–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è –ø–æ —Ä–µ–π—Å—É (–µ—Å–ª–∏ –µ—Å—Ç—å)</p>
                
                <div class="form-group">
                    <label for="wishes">–ü–æ–∂–µ–ª–∞–Ω–∏—è</label>
                    <textarea id="wishes" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ª–µ—Ç–∞, –Ω–æ–º–µ—Ä —Ä–µ–π—Å–∞ –∏ —Ç.–¥. –ï—Å–ª–∏ –ø–æ–∂–µ–ª–∞–Ω–∏–π –Ω–µ—Ç, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–æ—á–µ—Ä–∫ (-)"></textarea>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="goToStep('step-direction')">‚Üê –ù–∞–∑–∞–¥</button>
                    <button class="btn btn-primary" onclick="submitWishes()">–î–∞–ª–µ–µ ‚Üí</button>
                </div>
            </div>

            <!-- –®–∞–≥ 8: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ -->
            <div class="step" id="step-confirmation">
                <h2 class="step-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏</h2>
                <p class="step-description">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π</p>
                
                <div class="summary" id="summary">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="goToStep('step-wishes')">‚Üê –ù–∞–∑–∞–¥</button>
                    <button class="btn btn-success" onclick="confirmApplication()">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                </div>
            </div>

            <!-- –®–∞–≥ 9: –£—Å–ø–µ—Ö -->
            <div class="step" id="step-success">
                <div class="success-message">
                    <div class="success-icon">üéâ</div>
                    <h2>–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                    <p>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ. –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –¶–ü.</p>
                    <button class="btn btn-primary" onclick="startNewApplication()">–ü–æ–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É</button>
                </div>
            </div>

            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à –∑–∞–ø—Ä–æ—Å...</p>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentStep = 'step-location';
        let currentMonth = new Date().getMonth() + 1;
        let currentYear = new Date().getFullYear();
        let userData = {
            user_id: '{{ user_data.user_id }}',
            location: null,
            oke: null,
            selected_date: null,
            position: null,
            fio: null,
            tab_num: null,
            direction: null,
            wishes: null
        };

        // –°–ª–æ–≤–∞—Ä—å –û–ö–≠ –ø–æ –ª–æ–∫–∞—Ü–∏—è–º
        const okeOptions = {
            '–ú–°–ö': ['–û–ö–≠ 1', '–û–ö–≠ 2', '–û–ö–≠ 3', '–û–õ–°–∏–¢'],
            '–°–ü–ë': ['–û–ö–≠ 4', '–û–ö–≠ 5', '–û–õ–°–∏–¢'],
            '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫': ['–û–ö–≠ –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫', '–û–õ–°–∏–¢'],
            '–°–æ—á–∏': ['–û–ö–≠ –°–æ—á–∏', '–û–õ–°–∏–¢']
        };

        // –°–ª–æ–≤–∞—Ä—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
        const directions = {
            '–ú–°–ö': ['–ê–Ω–∞–¥—ã—Ä—å', '–ë–ª–∞–≥–æ–≤–µ—â–µ–Ω—Å–∫', '–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫', '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫', '–ú–∞–≥–∞–¥–∞–Ω', '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', '–°–∞–º–∞—Ä–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–£—Ñ–∞', '–•–∞–±–∞—Ä–æ–≤—Å–∫', '–Æ–∂–Ω–æ-–°–∞—Ö–∞–ª–∏–Ω—Å–∫', '–í–∞—Ä–∞–¥–µ—Ä–æ', '–•—É—Ä–≥–∞–¥–∞', '–®–∞—Ä–º-–≠–ª—å-–®–µ–π—Ö'],
            '–°–ü–ë': ['–í–æ–ª–≥–æ–≥—Ä–∞–¥', '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫', '–ú–æ—Å–∫–≤–∞', '–°–∞–º–∞—Ä–∞', '–°–æ—á–∏', '–•—É—Ä–≥–∞–¥–∞', '–®–∞—Ä–º-–≠–ª—å-–®–µ–π—Ö'],
            '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫': ['–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫', '–°–æ—á–∏', '–Æ–∂–Ω–æ-–°–∞—Ö–∞–ª–∏–Ω—Å–∫', '–•–∞–±–∞—Ä–æ–≤—Å–∫', '–°–∞–Ω—å—è'],
            '–°–æ—á–∏': []
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            generateCalendar();
        });

        function setupEventListeners() {
            // –í—ã–±–æ—Ä –ª–æ–∫–∞—Ü–∏–∏
            document.querySelectorAll('[data-location]').forEach(btn => {
                btn.addEventListener('click', function() {
                    userData.location = this.dataset.location;
                    this.classList.add('selected');
                    submitLocation(userData.location);
                });
            });

            // –í—ã–±–æ—Ä –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
            document.querySelectorAll('[data-position]').forEach(btn => {
                btn.addEventListener('click', function() {
                    userData.position = this.dataset.position;
                    this.classList.add('selected');
                    submitPosition(userData.position);
                });
            });
        }

        function goToStep(stepId) {
            // –°–∫—Ä—ã—Ç—å —Ç–µ–∫—É—â–∏–π —à–∞–≥
            document.getElementById(currentStep).classList.remove('active');
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π —à–∞–≥
            document.getElementById(stepId).classList.add('active');
            currentStep = stepId;

            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —à–∞–≥–æ–≤
            if (stepId === 'step-oke') {
                fillOkeOptions();
            } else if (stepId === 'step-direction') {
                fillDirectionOptions();
            } else if (stepId === 'step-confirmation') {
                fillSummary();
            }
        }

        function fillOkeOptions() {
            const container = document.getElementById('oke-options');
            const options = okeOptions[userData.location] || [];
            
            container.innerHTML = options.map(oke => 
                `<div class="option-btn" data-oke="${oke}">${oke}</div>`
            ).join('');

            // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            container.querySelectorAll('[data-oke]').forEach(btn => {
                btn.addEventListener('click', function() {
                    userData.oke = this.dataset.oke;
                    this.classList.add('selected');
                    submitOke(userData.oke);
                });
            });
        }

        function fillDirectionOptions() {
            const container = document.getElementById('direction-options');
            const options = directions[userData.location] || [];
            
            container.innerHTML = options.map(direction => 
                `<div class="option-btn" data-direction="${direction}">${direction}</div>`
            ).join('');

            // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            container.querySelectorAll('[data-direction]').forEach(btn => {
                btn.addEventListener('click', function() {
                    userData.direction = this.dataset.direction;
                    this.classList.add('selected');
                    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                    submitDirection();
                });
            });
        }

        function generateCalendar() {
            const container = document.getElementById('calendar');
            const monthTitle = document.getElementById('month-title');
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Å—è—Ü–∞
            const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                              '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
            monthTitle.textContent = `${monthNames[currentMonth - 1]} ${currentYear}`;

            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
            const dayHeaders = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            container.innerHTML = dayHeaders.map(day => 
                `<div class="calendar-header">${day}</div>`
            ).join('');

            // –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
            const firstDay = new Date(currentYear, currentMonth - 1, 1);
            const lastDay = new Date(currentYear, currentMonth, 0);
            const daysInMonth = lastDay.getDate();
            const startDay = (firstDay.getDay() + 6) % 7; // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 0

            // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞
            for (let i = 0; i < startDay; i++) {
                container.innerHTML += '<div class="calendar-day"></div>';
            }

            // –î–Ω–∏ –º–µ—Å—è—Ü–∞
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth - 1, day);
                const isToday = date.toDateString() === today.toDateString();
                const isPast = date < today;
                
                let classes = 'calendar-day';
                if (isToday) classes += ' today';
                if (isPast) classes += ' disabled';
                
                const dayElement = document.createElement('div');
                dayElement.className = classes;
                dayElement.textContent = day;
                
                if (!isPast) {
                    dayElement.addEventListener('click', function() {
                        // –£–±—Ä–∞—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö –¥–Ω–µ–π
                        container.querySelectorAll('.calendar-day').forEach(el => {
                            el.classList.remove('selected');
                        });
                        
                        // –í—ã–¥–µ–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å
                        this.classList.add('selected');
                        
                        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞—Ç—É
                        userData.selected_date = `${day.toString().padStart(2, '0')}.${currentMonth.toString().padStart(2, '0')}.${currentYear}`;
                        
                        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞—Ç—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                        submitDate(userData.selected_date);
                    });
                }
                
                container.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 12) {
                currentMonth = 1;
                currentYear++;
            } else if (currentMonth < 1) {
                currentMonth = 12;
                currentYear--;
            }
            generateCalendar();
        }

        function submitLocation(location) {
            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/api/select-location', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userData.user_id,
                    location: location
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('–õ–æ–∫–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:', data.message);
                    // –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                    setTimeout(() => {
                        goToStep('step-oke');
                    }, 300);
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏:', data.error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏');
            });
        }

        function submitOke(oke) {
            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –û–ö–≠ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/api/select-oke', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userData.user_id,
                    oke: oke
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('–û–ö–≠ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ:', data.message);
                    // –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                    setTimeout(() => {
                        goToStep('step-date');
                    }, 300);
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –û–ö–≠:', data.error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –û–ö–≠: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –û–ö–≠');
            });
        }

        function submitPosition(position) {
            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–ª–∂–Ω–æ—Å—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/api/select-position', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userData.user_id,
                    position: position
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('–î–æ–ª–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:', data.message);
                    // –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                    setTimeout(() => {
                        goToStep('step-fio');
                    }, 300);
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏:', data.error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏');
            });
        }

        function submitDate(date) {
            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞—Ç—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/api/select-date', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userData.user_id,
                    date: date
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('–î–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:', data.message);
                    // –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                    setTimeout(() => {
                        goToStep('step-position');
                    }, 500);
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã:', data.error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã');
            });
        }

        function submitFio() {
            const fio = document.getElementById('fio').value.trim();
            const tabNum = document.getElementById('tab-num').value.trim();
            
            if (!fio || !tabNum) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            userData.fio = fio;
            userData.tab_num = tabNum;
            
            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –§–ò–û –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/api/input-fio', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userData.user_id,
                    fio: fio,
                    tab_num: tabNum
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('–§–ò–û —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ:', data.message);
                    goToStep('step-direction');
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –§–ò–û:', data.error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –§–ò–û: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –§–ò–û');
            });
        }

        function submitDirection() {
            const customDirection = document.getElementById('custom-direction').value.trim();
            
            if (customDirection) {
                userData.direction = customDirection;
            }
            
            if (!userData.direction) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ');
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/api/select-direction', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userData.user_id,
                    direction: userData.direction
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ:', data.message);
                    goToStep('step-wishes');
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:', data.error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è');
            });
        }

        function submitWishes() {
            const wishes = document.getElementById('wishes').value.trim() || '-';
            userData.wishes = wishes;
            
            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/api/input-wishes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userData.user_id,
                    wishes: wishes
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('–ü–æ–∂–µ–ª–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', data.message);
                    goToStep('step-confirmation');
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–∂–µ–ª–∞–Ω–∏–π:', data.error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–∂–µ–ª–∞–Ω–∏–π: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–∂–µ–ª–∞–Ω–∏–π');
            });
        }

        function fillSummary() {
            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <div class="summary-item">
                    <span class="summary-label">–õ–æ–∫–∞—Ü–∏—è:</span>
                    <span class="summary-value">${userData.location}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–û–ö–≠:</span>
                    <span class="summary-value">${userData.oke}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–î–∞—Ç–∞:</span>
                    <span class="summary-value">${userData.selected_date}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å:</span>
                    <span class="summary-value">${userData.position}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–§–ò–û:</span>
                    <span class="summary-value">${userData.fio}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä:</span>
                    <span class="summary-value">${userData.tab_num}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</span>
                    <span class="summary-value">${userData.direction}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–ü–æ–∂–µ–ª–∞–Ω–∏—è:</span>
                    <span class="summary-value">${userData.wishes}</span>
                </div>
            `;
        }

        function confirmApplication() {
            showLoading();
            
            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/api/confirm', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(userData)
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    goToStep('step-success');
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏');
            });
        }

        function startNewApplication() {
            // –°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            userData = {
                user_id: userData.user_id,
                location: null,
                oke: null,
                selected_date: null,
                position: null,
                fio: null,
                tab_num: null,
                direction: null,
                wishes: null
            };
            
            // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—ã
            document.getElementById('fio').value = '';
            document.getElementById('tab-num').value = '';
            document.getElementById('custom-direction').value = '';
            document.getElementById('wishes').value = '';
            
            // –£–±—Ä–∞—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏—è
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–µ—Ä–≤–æ–º—É —à–∞–≥—É
            goToStep('step-location');
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

    </script>
</body>
</html>
